function R = quat_to_rotation_matrix(q)
    q2 = q*q';
    R = [q2(1,1)+q2(2,2)-q2(3,3)-q2(4,4) 2*(q2(2,3)-q2(1,4)) 2*(q2(2,4)+q2(1,3)); ...
         2*(q2(2,3)+q2(1,4)) q2(1,1)-q2(2,2)+q2(3,3)-q2(4,4) 2*(q2(3,4)-q2(1,2)); ...
         2*(q2(2,4)-q2(1,3)) 2*(q2(3,4)+q2(1,2)) q2(1,1)-q2(2,2)-q2(3,3)+q2(4,4)];
end
    
   